angular.module("adminApp.modules",[]).controller("ModulesController",function(e,o,t,n,l,a,i,s,r,u,c){function d(o,t,n){e.module.type="toggle",e.module.pages=[{title:"Listar todos os "+n,type:"link",state:"listItems({section: '"+o+"'})"},{title:"Adicionar "+t,type:"link",state:"newItem({section: '"+o+"'})"}],e.module.taxonomy&&angular.forEach(e.module.taxonomy,function(t){e.module.pages.push({title:t.title,type:"link",state:"tax({tax: '"+t.slug+"', section: '"+o+"'})"})})}function m(e){var o=function(e){return null===e?"":""+e},t="ąàáäâãåæăćčĉęèéëêĝĥìíïîĵłľńňòóöőôõðøśșšŝťțŭùúüűûñÿýçżźž",n="aaaaaaaaaccceeeeeghiiiijllnnoooooooossssttuuuuuunyyczzz",l=new RegExp("["+t+"]","g");return e=o(e).toString().toLowerCase().replace(l,function(e){var o=t.indexOf(e);return n.charAt(o)||"-"}).replace(/[^\w\-\s]+/g,"").trim().replace(/\s+/g,"-").replace(/\-\-+/g,"-")}console.log("controller: ModulesController"),o.id?c.one(o.id).get().then(function(o){e.module=o}):e.module=c.one(),u.getList().then(function(o){e.grupos=o}),s.query(function(o){e.iconsSelect=o}),e.addTaxonomy=function(o){var t=m(o);e.module.taxonomy||(e.module.taxonomy=[]),e.module.taxonomy.push({title:o,slug:t})},e.removeTaxonomy=function(o,t){var n=l.confirm().parent(angular.element(document.body)).title("Deseja deletar a Taxonomy selecionada?").content("* Esta taxonomy será removida permanentemente.").ariaLabel("Remover Taxonomy").ok("DELETAR").cancel("CANCELAR").targetEvent(o);l.show(n).then(function(){e.module.taxonomy.splice(t,1)})},e.toggle=function(o,t){e.module.taxonomy=t,e.item.cats||(e.item.cats=[]);var n=e.item.cats.indexOf(o);n>-1?e.item.cats.splice(n,1):e.item.cats.push(o)},e.exists=function(e,o){return o?o.indexOf(e)>-1:void 0},e.saveModule=function(o){t.put(i.db+"/"+e.module.slug,{desc:"Collection: "+e.module.slug}).then(function(o){console.log("Collection: "+e.module.slug+" criada com sucesso.")},function(e){console.log("Collection: Erro ao criar.")});var l=e.module.slug,s=e.module.titles,r=e.module.titlep;d(l,s,r),e.module.save().then(function(){n.reload("admin","sidebar",{reload:!0}),a.msgToast('Módulo "'+e.module.title+'" ...Criado!')})},e.updateModule=function(o){var t=e.module.slug,l=e.module.titles,i=e.module.titlep;d(t,l,i),e.module.put().then(function(o){n.reload("admin","sidebar",{reload:!0}),a.msgToast('Módulo "'+e.module.title+'" ...Atualizado!')})},e.slugify=function(o){e.module.slug=m(o)}}).controller("ModulesListController",function(e,o,t,n,l,a,i){console.log("controller: ModulesListController");var s;e.selected=[],e.filter={options:{debounce:500}},e.query={pagesize:"10",sort_by:"-_created_on",page:1,count:""},e.onChange=function(){i.getList(e.query).then(function(o){e.modulesList=o})},e.removeFilter=function(){e.filter.show=!1,e.query.filter={},e.filter.form.$dirty&&e.filter.form.$setPristine()},e.$watch("query.filter",function(o,t){t||(s=e.query.page),o!==t&&(e.query.page=1),o||(e.query.page=s)}),e.deleteModule=function(i,s,r){var u=t.confirm().parent(angular.element(document.body)).title("Deseja deletar este Módulo?").content("* Este item será removido permanentemente.").ariaLabel("Remover Item").ok("DELETAR").cancel("CANCELAR").targetEvent(r);t.show(u).then(function(){o.get(a.db+"/"+i.slug).then(function(t){var r=t.data._etag.$oid;o["delete"](a.db+"/"+i.slug,{headers:{"If-Match":r}}).then(function(o){console.log("Collection: "+i.slug+" deletada com sucesso."),i.remove(null,{"If-Match":i._id.$oid}).then(function(){e.modulesList.splice(s,1),n.reload("admin","sidebar",{reload:!0}),l.msgToast("modules #"+i._id.$oid+" ...Deletado!")})},function(e){console.log("Collection: Erro ao criar.")})})})},e.deleteModules=function(o,n){var a=e.selected,i=t.confirm().parent(angular.element(document.body)).title("Deseja deletar os Módulos selecionados?").content("* Estes itens serão removidos permanentemente.").ariaLabel("Remover Items").ok("DELETAR").cancel("CANCELAR").targetEvent(o);t.show(i).then(function(){angular.forEach(a,function(o){o.remove(null,{"If-Match":o._id.$oid}).then(function(){var t=e.items.indexOf(o);e.selected=[],e.items.splice(t,1),l.msgToast(e.section+" #"+o._id.$oid+" ...Deletados!")})})})}}).controller("ModulesTaxController",function(e,o,t,n,l,a){console.log("controller: ModulesTaxController");var i=n.tax,s=n.section;a.getList({filter:{slug:s}}).then(function(o){var t=o[0].taxonomy,n=o[0]._id.$oid;e.taxonomys=t,e.taxonomy=_.find(t,{slug:i}),a.one(n).get().then(function(o){e.moduletaxes=o})}),e.saveTaxes=function(){e.moduletaxes.taxonomy=e.taxonomys,e.moduletaxes.save().then(function(){l.msgToast("Categorias atualizadas!")})},e.addTax=function(o){e.taxonomy.tax||(e.taxonomy.tax=[]),e.taxonomy.tax.push({title:o.title,slug:o.slug,desc:o.desc})},e.remTax=function(t,n){var l=o.confirm().parent(angular.element(document.body)).title("Deseja deletar a Taxonomy selecionada?").content("* Esta taxonomy será removida permanentemente.").ariaLabel("Remover Taxonomy").ok("DELETAR").cancel("CANCELAR").targetEvent(t);o.show(l).then(function(){e.taxonomy.tax.splice(n,1)})},e.slugify=function(o){str=o.replace("-"),str=angular.lowercase(str),str=str.replace(/[^A-Z0-9]+/gi,"-"),e.tax.slug=str}});